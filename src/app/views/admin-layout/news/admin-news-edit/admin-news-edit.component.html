<app-preloader *ngIf="isPosting"/>

<h2>Edit News {{newsId}}</h2>

<div class="buttons">
  <a [relativeTo]="route.parent" [routerLink]="r.newsDetail"
     class="btn">Detail</a>

  <button (click)="videoFoldersToDb()" class="btn" type="button">
    Video Folders to DB
  </button>
</div>


<form #ngForm="ngForm" (ngSubmit)="onSubmitMain()">
  <label for="category-id">Category</label>
  <select [(ngModel)]="form.categoryId" id="category-id" name="category_id"
          required>
    <option *ngFor="let c of categories"
            [ngValue]="c.id"
            [selected]="form.categoryId == c.id">{{c.name}} - {{c.parentCategory?.name}}</option>
  </select>

  <label class="required" for="name">Name</label>
  <input [(ngModel)]="form.name" id="name" name="name" required type="text">

  <label (click)="allowSlugUpdate = !allowSlugUpdate" class="required"
         for="slug">Slug (click to allow change)</label>
  <input (input)="updateSlug()" [(ngModel)]="form.slug" [readonly]="!allowSlugUpdate"
         id="slug"
         name="slug"
         required type="text">

  <div class="checkbox-block">
    <input [(ngModel)]="form.popular" id="popular" name="popular" type="checkbox">
    <label for="popular">Popular</label>
  </div>

  <label for="description">Description</label>
  <textarea [(ngModel)]="form.description"
            [rows]="5"
            id="description" name="description"></textarea>

  <label for="article">Article</label>
  <textarea [(ngModel)]="form.article"
            [rows]="5"
            id="article" name="article"></textarea>


  <!-- image preview -->
  <!-- <div *ngIf="form.mainImage"
       style="display: flex; flex-wrap: wrap; gap: 20px; margin-bottom: 20px">
    <img [src]="imageFile" alt="" width="200">
    <div>
      <div><b>KB</b>: {{(form.mainImage.size / 1024)|number}} kilobytes</div>
      <div><b>MB</b>: {{(form.mainImage.size / (1024 * 1024))|number}} megabytes</div>

      <div><b>Filename</b>: {{form.mainImage.name}}</div>
    </div>
  </div> -->
  <!-- end image preview -->


  <!--  <label for="image">Image</label>
   <input (change)="showImage($event.target)"
          class="btn"
          id="image"
          name="image"
          type="file"> -->


  <label for="newsLink">News Link <a [href]="form.newsLink" target="_blank">[Open]</a></label>
  <input [(ngModel)]="form.newsLink"
         id="newsLink"
         name="newsLink"
         type="text">

  <div>{{form.tags|json}}</div>
  <label for="tags">NewsTag[] - Tags - '|' - separator</label>
  <input (input)="updateFormTags()"
         [(ngModel)]="tagsString"
         id="tags"
         name="tags"
         type="text">


  <label for="dislikes">Dislikes</label>
  <input [(ngModel)]="form.disLikes"
         id="dislikes"
         min="0"
         name="dislikes"
         step="1"
         type="number">

  <label for="likes">Likes</label>
  <input [(ngModel)]="form.likes"
         id="likes"
         min="0"
         name="likes"
         step="1"
         type="number">


  <br/>


  <!-- calc likes from udemy rating -->
  <app-card>
    <app-card-header>
      Calc Likes from Udemy Rating (not required)
    </app-card-header>
    <app-card-body>
      <div>
        <label>
          udemy_max_rating
          <span (click)="udemyMaxRatingReadonly = !udemyMaxRatingReadonly">[EDIT] </span>

          <input [(ngModel)]="udemy.maxRating"
                 [readOnly]="udemyMaxRatingReadonly"
                 name="udemy_max_rating"
                 step="1" type="number">
        </label>

      </div>
      <div>
        <div>
          <label>
            udemy_rating
            <input [(ngModel)]="udemy.rating" name="udemy_rating" step="0.1" type="number">
          </label>
        </div>
      </div>

      <div>
        <div>
          <label>
            udemy_count
            <input [(ngModel)]="udemy.count" name="udemy_count" step="1" type="number">
          </label>
        </div>
      </div>
      <button (click)="countLikesFromUdemy()" class="btn btn-small" type="button">Calc likes</button>
    </app-card-body>
  </app-card>

  <!-- end calc likes from udemy rating -->


  <div class="checkbox-block">
    <input [(ngModel)]="form.removeImage"
           id="remove-image"
           name="remove_image"
           type="checkbox">
    <label for="remove-image">Remove Image</label>
  </div>


  <button [disabled]="isPosting || ngForm.invalid || ngForm.pristine"
          class="btn"
          type="submit">
    {{isPosting ? 'Posting...' : "Update News"}}
  </button>

  <div *ngIf="errors" class="alert alert-danger">
    <pre>{{errors|json}}</pre>
  </div>
</form>


<!-- Update News MainImage -->
<img *ngIf="mainThumbPath"
     [src]="mainThumbPath" alt="main thumb preview" width="200">
<form (ngSubmit)="onSubmitImageForm()">

  <label for="image">Update image</label>
  <input (change)="updateImagePreview($event)" class="btn" id="image" name="image"
         type="file">
  <button class="btn" type="submit">Update image</button>
</form>


